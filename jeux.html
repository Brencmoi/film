<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portail de Jeux</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Press+Start+2P&display=swap" rel="stylesheet">
    <!-- Icônes Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <style>
        :root {
            --background-color: #0c0a18;
            --text-primary: #f0f0f0;
            --primary-accent: #00ffc3;
            --secondary-accent: #ff00c1;
            --card-bg: rgba(0, 255, 195, 0.05);
            --card-border: rgba(0, 255, 195, 0.2);
            --font-pixel: 'Press Start 2P', cursive;
            --font-sans: 'Inter', sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-primary);
            font-family: var(--font-sans);
            overflow-x: hidden;
        }
        
        /* --- Conteneurs principaux --- */
        .game-section {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem 1rem;
            animation: fadeIn 0.5s ease-in-out;
        }

        .game-container { display: none; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- Écran de sélection des jeux --- */
        #game-selection-screen h1 {
            font-family: var(--font-pixel);
            color: var(--primary-accent);
            text-shadow: 0 0 10px var(--primary-accent), 0 0 20px var(--secondary-accent);
            font-size: clamp(1.8rem, 8vw, 3rem);
            margin-bottom: 3rem;
        }

        .game-card {
            background: var(--card-bg);
            border: 2px solid var(--card-border);
            border-radius: 1rem;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            backdrop-filter: blur(5px);
            height: 100%;
        }

        .game-card:hover {
            transform: scale(1.05);
            border-color: var(--primary-accent);
            box-shadow: 0 0 20px rgba(0, 255, 195, 0.3);
        }

        .game-card i { font-size: 3rem; color: var(--primary-accent); margin-bottom: 1rem; }
        .game-card h3 { font-family: var(--font-pixel); font-size: 0.8rem; }

        /* --- Boutons de navigation --- */
        .back-button {
            position: fixed; top: 15px; left: 15px; z-index: 10000;
            border-radius: 50%; width: 45px; height: 45px;
            display: flex; align-items: center; justify-content: center;
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white; transition: all 0.3s ease; text-decoration: none;
        }

        .back-button:hover { background-color: var(--primary-accent); color: var(--background-color); }

        /* --- Style générique des jeux --- */
        .game-title { font-family: var(--font-pixel); color: var(--primary-accent); margin-bottom: 2rem; text-align: center; font-size: 1.5rem; }
        .game-btn { font-family: var(--font-pixel); font-size: 0.7rem; padding: 0.7rem 1.2rem; border-radius: 8px; border: 2px solid var(--primary-accent); background: transparent; color: var(--primary-accent); transition: all 0.3s ease; }
        .game-btn:hover:not(:disabled) { background: var(--primary-accent); color: var(--background-color); box-shadow: 0 0 15px var(--primary-accent); }
        .game-btn:disabled { border-color: #555; color: #555; cursor: not-allowed; }
        .game-canvas { background-color: #111; border: 2px solid var(--primary-accent); box-shadow: 0 0 15px var(--primary-accent); max-width: 100%; height: auto; }
        .score-container { font-size: 1.2rem; margin-bottom: 1rem; }
        .game-instructions { font-size: 0.8rem; color: var(--text-secondary); margin-top: 1rem; }

        /* --- Style JOKER POKER (BALATRO) --- */
        #game-jokerpoker-container { background-color: #1a1a2e; position: relative; }
        #game-jokerpoker-container::before { content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px); background-size: 100% 3px; pointer-events: none; z-index: 1; }
        #game-jokerpoker { max-width: 900px; width:100%; text-align: center; position: relative; z-index: 2;}
        .jokerpoker-ui-grid { display: grid; grid-template-columns: 1fr 2fr 1fr; gap: 1rem; font-family: var(--font-pixel); font-size: 0.7rem; margin-bottom: 1rem; color: #fff; }
        .jokerpoker-info-box { background: #16213e; border: 2px solid #0f3460; padding: 0.5rem; border-radius: 8px; text-align: left; }
        .jokerpoker-info-box h4 { font-size: 0.8rem; color: var(--secondary-accent); margin-bottom: 0.5rem;}
        .jokerpoker-info-box p { margin-bottom: 0.2rem; } .jokerpoker-info-box span { color: var(--primary-accent); }
        #jokerpoker-jokers-area { grid-column: span 3; background: #16213e; border: 2px solid #0f3460; min-height: 80px; border-radius: 8px; padding: 0.5rem; display: flex; gap: 10px; align-items: center; flex-wrap: wrap;}
        .jokerpoker-joker { background: #e94560; color: #fff; padding: 0.5rem; border-radius: 5px; font-family: var(--font-sans); text-align: center; border: 2px solid #a42c3e; width: 90px; }
        .jokerpoker-joker h5 { font-size: 0.8rem; font-weight: bold; margin-bottom: 0.2rem;} .jokerpoker-joker p { font-size: 0.7rem; line-height: 1.2; }
        #jokerpoker-hand { min-height: 120px; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; margin: 1.5rem 0;}
        .jokerpoker-card { width: 80px; height: 110px; border-radius: 8px; background: #fff; color: #000; border: 2px solid #aaa; cursor: pointer; box-shadow: 3px 3px 5px rgba(0,0,0,0.3); transition: all 0.2s ease; position: relative; display: flex; flex-direction: column; justify-content: space-between; padding: 5px; }
        .jokerpoker-card.selected { transform: translateY(-20px); border-color: var(--primary-accent); box-shadow: 0 10px 15px var(--primary-accent);}
        .jokerpoker-card-value { font-size: 1.5rem; font-weight: bold; align-self: flex-start; } .jokerpoker-card-suit { font-size: 1.5rem; align-self: flex-end; } .jokerpoker-card.red { color: #d63031; }
        #jokerpoker-play-area { margin-top: 1rem; text-align: center; }
        #jokerpoker-hand-info { background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px; font-size: 1.2rem; min-height: 60px; font-weight: bold; display: flex; align-items: center; justify-content: center; gap: 20px; margin-bottom: 1rem; }
        #jokerpoker-hand-name { color: var(--primary-accent); font-family: var(--font-pixel); font-size: 1rem;} #jokerpoker-hand-score { color: var(--text-primary); font-size: 1.2rem;}
        #jokerpoker-shop-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); display: none; align-items: center; justify-content: center; flex-direction: column; z-index: 10; }
        #jokerpoker-shop-items { display: flex; gap: 1rem; margin-bottom: 1rem;}
        .jokerpoker-shop-item { background: #16213e; border: 2px solid #0f3460; padding: 1rem; text-align: center; border-radius: 8px; cursor: pointer; }
        .jokerpoker-shop-item:hover { border-color: var(--primary-accent); }

    </style>
</head>
<body>

    <a href="index.html" class="back-button" title="Retour au blog"><i class="bi bi-house-door-fill"></i></a>
    <button id="back-to-menu-btn" class="back-button" title="Retour au menu" style="display: none; left: 75px;"><i class="bi bi-list"></i></button>

    <div id="game-selection-screen" class="game-section">
        <div class="container text-center">
            <h1>ARCADE</h1>
            <div class="row g-4 g-md-5 justify-content-center">
                <div class="col-4 col-md-3 col-lg-2"><div class="game-card" data-game="jokerpoker"><i class="bi bi-suit-club-fill"></i><h3>Joker Poker</h3></div></div>
                <div class="col-4 col-md-3 col-lg-2"><div class="game-card" data-game="tetris"><i class="bi bi-bricks"></i><h3>Tetris</h3></div></div>
                <div class="col-4 col-md-3 col-lg-2"><div class="game-card" data-game="pacman"><i class="bi bi-joystick"></i><h3>Pac-Man</h3></div></div>
                <div class="col-4 col-md-3 col-lg-2"><div class="game-card" data-game="snake"><i class="bi bi-bug-fill"></i><h3>Snake</h3></div></div>
                <div class="col-4 col-md-3 col-lg-2"><div class="game-card" data-game="pong"><i class="bi bi-arrows-expand-vertical"></i><h3>Pong</h3></div></div>
                <div class="col-4 col-md-3 col-lg-2"><div class="game-card" data-game="breakout"><i class="bi bi-distribute-vertical"></i><h3>Breakout</h3></div></div>
                <div class="col-4 col-md-3 col-lg-2"><div class="game-card" data-game="minesweeper"><i class="bi bi-flag-fill"></i><h3>Démineur</h3></div></div>
                <div class="col-4 col-md-3 col-lg-2"><div class="game-card" data-game="tictactoe"><i class="bi bi-hash"></i><h3>Morpion</h3></div></div>
                <div class="col-4 col-md-3 col-lg-2"><div class="game-card" data-game="2048"><i class="bi bi-grid-1x2-fill"></i><h3>2048</h3></div></div>
                <div class="col-4 col-md-3 col-lg-2"><div class="game-card" data-game="blackjack"><i class="bi bi-suit-spade-fill"></i><h3>Blackjack</h3></div></div>
                <div class="col-4 col-md-3 col-lg-2"><div class="game-card" data-game="memory"><i class="bi bi-question-diamond-fill"></i><h3>Memory</h3></div></div>
                <div class="col-4 col-md-3 col-lg-2"><div class="game-card" data-game="connectfour"><i class="bi bi-grid-3x3-gap-fill"></i><h3>Puissance 4</h3></div></div>
                <div class="col-4 col-md-3 col-lg-2"><div class="game-card" data-game="hangman"><i class="bi bi-emoji-dizzy-fill"></i><h3>Pendu</h3></div></div>
                <div class="col-4 col-md-3 col-lg-2"><div class="game-card" data-game="flappybird"><i class="bi bi-cloud-fill"></i><h3>Flappy Bird</h3></div></div>
            </div>
        </div>
    </div>
    
    <!-- Les conteneurs de jeux seront générés dynamiquement par le script ci-dessous -->

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- MOTEUR DE NAVIGATION PRINCIPAL ---
        const gameSelectionScreen = document.getElementById('game-selection-screen');
        const backToMenuBtn = document.getElementById('back-to-menu-btn');
        const gameCards = document.querySelectorAll('.game-card');
        let activeGameLoop = null;
        let activeKeyListener = null;

        gameCards.forEach(card => card.addEventListener('click', () => showGame(card.dataset.game)));
        backToMenuBtn.addEventListener('click', showMenu);
        
        // Création dynamique des conteneurs de jeux
        const allGameIds = Array.from(gameCards).map(gc => gc.dataset.game);
        allGameIds.forEach(id => {
            if (!document.getElementById(`game-${id}-container`)) {
                const container = document.createElement('div');
                container.id = `game-${id}-container`;
                container.className = 'game-container game-section';
                document.body.appendChild(container);
            }
        });
        const gameContainers = document.querySelectorAll('.game-container');

        function showGame(gameId) {
            // Nettoyage de l'état précédent
            if (activeGameLoop) {
                if (typeof activeGameLoop === 'number') cancelAnimationFrame(activeGameLoop);
                else clearInterval(activeGameLoop);
                activeGameLoop = null;
            }
            if(activeKeyListener) document.removeEventListener('keydown', activeKeyListener);
            
            gameSelectionScreen.style.display = 'none';
            backToMenuBtn.style.display = 'flex';
            gameContainers.forEach(container => container.style.display = 'none');
            
            const activeContainer = document.getElementById(`game-${gameId}-container`);
            if (activeContainer) {
                activeContainer.style.display = 'flex';
                const initFunctionName = `init${gameId.charAt(0).toUpperCase() + gameId.slice(1)}`;
                if (window[initFunctionName]) window[initFunctionName]();
            }
        }

        function showMenu() {
            if (activeGameLoop) {
                if (typeof activeGameLoop === 'number') cancelAnimationFrame(activeGameLoop);
                else clearInterval(activeGameLoop);
                activeGameLoop = null;
            }
             if(activeKeyListener) document.removeEventListener('keydown', activeKeyListener);
            
            gameSelectionScreen.style.display = 'flex';
            backToMenuBtn.style.display = 'none';
            gameContainers.forEach(container => container.style.display = 'none');
        }

        // --- MOTEUR DE JEU : JOKER POKER (BALATRO) ---
        const jokerPoker = {
            dom: {
                container: document.getElementById('game-jokerpoker-container')
            },
            deck: [], hand: [], selectedCards: [],
            ranks: "2,3,4,5,6,7,8,9,T,J,Q,K,A".split(","),
            suits: "♥,♦,♣,♠".split(","),
            cardChips: { 'A': 11, 'K': 10, 'Q': 10, 'J': 10, 'T': 10, '9': 9, '8': 8, '7': 7, '6': 6, '5': 5, '4': 4, '3': 3, '2': 2 },
            handLevels: {
                "Haute Carte": { chips: 5, multi: 1 }, "Paire": { chips: 10, multi: 2 }, "Double Paire": { chips: 20, multi: 3 },
                "Brelan": { chips: 30, multi: 4 }, "Suite": { chips: 40, multi: 5 }, "Couleur": { chips: 50, multi: 6 },
                "Full": { chips: 60, multi: 7 }, "Carré": { chips: 80, multi: 8 }, "Quinte Flush": { chips: 100, multi: 10 },
            },
            blinds: [
                { name: "Petit Blind", score: 300, reward: 3 }, { name: "Gros Blind", score: 800, reward: 4 }, { name: "Le Mur", score: 2000, reward: 5 },
            ],
            jokerDatabase: [
                { name: "Joker Fou", desc: "+4 Multi", cost: 3, effect: (calc) => { calc.totalMulti += 4; } },
                { name: "Le Glouton", desc: "+40 Jetons", cost: 3, effect: (calc) => { calc.totalChips += 40; } },
                { name: "As de Pique", desc: "Les Piques donnent +30 Jetons", cost: 4, effect: (calc, hand) => { hand.forEach(c => { if(c.suit === '♠') calc.totalChips += 30; }); }},
                { name: "Roi de Coeur", desc: "x2 Multi si main contient un Roi", cost: 4, effect: (calc, hand) => { if(hand.some(c=>c.rank === 'K')) calc.totalMulti *= 2; }}
            ],
            state: {},

            init: function() {
                this.dom.container.innerHTML = `
                    <div id="game-jokerpoker">
                        <div class="jokerpoker-ui-grid">
                            <div class="jokerpoker-info-box"> <h4>Objectif</h4> <p>Blind: <span id="jokerpoker-blind-name"></span></p> <p>Score Requis: <span id="jokerpoker-target-score"></span></p> </div>
                            <div class="jokerpoker-info-box" style="text-align: center;"> <h4>Jeu</h4> <p>Mains: <span id="jokerpoker-hands-left"></span> | Défausses: <span id="jokerpoker-discards-left"></span></p> <p>Argent: $<span id="jokerpoker-money"></span></p> </div>
                            <div class="jokerpoker-info-box"> <h4>Score Actuel</h4> <p><span id="jokerpoker-current-score"></span></p> </div>
                            <div id="jokerpoker-jokers-area"></div>
                        </div>
                        <div id="jokerpoker-hand"></div>
                        <div id="jokerpoker-play-area">
                            <div id="jokerpoker-hand-info"></div>
                            <button id="jokerpoker-play-btn" class="game-btn mx-2">Jouer</button>
                            <button id="jokerpoker-discard-btn" class="game-btn mx-2">Défausser</button>
                        </div>
                        <div id="jokerpoker-message-area" class="mt-3 fs-5" style="font-family: var(--font-pixel); color: var(--secondary-accent);"></div>
                    </div>
                    <div id="jokerpoker-shop-overlay">
                        <div>
                            <h2 class="game-title">MAGASIN</h2>
                            <div id="jokerpoker-shop-items"></div>
                            <button id="jokerpoker-continue-btn" class="game-btn mt-3">Continuer</button>
                        </div>
                    </div>`;
                
                // Re-bind DOM elements
                const ids = ['targetScoreEl', 'currentScoreEl', 'handsLeftEl', 'discardsLeftEl', 'moneyEl', 'blindNameEl', 'jokersAreaEl', 'handEl', 'handInfoEl', 'messageAreaEl', 'playBtn', 'discardBtn', 'shopOverlay', 'shopItemsEl', 'continueBtn'];
                const domNames = ['jokerpoker-target-score', 'jokerpoker-current-score', 'jokerpoker-hands-left', 'jokerpoker-discards-left', 'jokerpoker-money', 'jokerpoker-blind-name', 'jokerpoker-jokers-area', 'jokerpoker-hand', 'jokerpoker-hand-info', 'jokerpoker-message-area', 'jokerpoker-play-btn', 'jokerpoker-discard-btn', 'jokerpoker-shop-overlay', 'jokerpoker-shop-items', 'jokerpoker-continue-btn'];
                ids.forEach((el, i) => this.dom[el] = document.getElementById(domNames[i]));

                this.dom.playBtn.addEventListener('click', () => this.playHand());
                this.dom.discardBtn.addEventListener('click', () => this.discardHand());
                this.dom.continueBtn.addEventListener('click', () => this.startNextBlind());
                this.startNewGame();
            },
            startNewGame: function() { this.state = { money: 0, currentBlindIndex: 0, jokers: [] }; this.startBlind(); },
            startBlind: function() {
                const blind = this.blinds[this.state.currentBlindIndex];
                this.state = { ...this.state, handsLeft: 4, discardsLeft: 3, currentScore: 0, targetScore: blind.score };
                this.dom.shopOverlay.style.display = 'none'; this.dom.messageAreaEl.textContent = '';
                this.hand = []; this.selectedCards = [];
                this.createDeck(); this.drawHand(8);
                this.updateUI(); this.toggleButtons(true);
            },
            createDeck: function() {
                this.deck = this.suits.flatMap(suit => this.ranks.map(rank => ({ rank, suit, value: this.ranks.indexOf(rank) + 2 })));
                this.deck.sort(() => Math.random() - 0.5);
            },
            drawHand: function(num) {
                for (let i = 0; i < num; i++) {
                    if (this.hand.length >= 8) break;
                    if (this.deck.length === 0) this.createDeck();
                    this.hand.push(this.deck.pop());
                } this.renderHand();
            },
            renderHand: function() {
                this.dom.handEl.innerHTML = '';
                this.hand.forEach((card) => {
                    const cardEl = document.createElement('div');
                    cardEl.className = `jokerpoker-card ${card.suit === '♥' || card.suit === '♦' ? 'red' : ''}`;
                    cardEl.innerHTML = `<span class="jokerpoker-card-value">${card.rank}</span><span class="jokerpoker-card-suit">${card.suit}</span>`;
                    cardEl.addEventListener('click', () => this.selectCard(cardEl, card));
                    this.dom.handEl.appendChild(cardEl);
                });
            },
            selectCard: function(cardEl, card) {
                const cardIndex = this.selectedCards.indexOf(card);
                if (cardIndex > -1) { this.selectedCards.splice(cardIndex, 1); cardEl.classList.remove('selected'); } 
                else if (this.selectedCards.length < 5) { this.selectedCards.push(card); cardEl.classList.add('selected'); }
                this.updateHandInfo();
            },
            calculateScore: function(hand) {
                 if (hand.length === 0) return null;
                hand.sort((a,b) => a.value - b.value);
                const ranks = hand.map(c => c.value); const suits = hand.map(c => c.suit);
                const rankCounts = ranks.reduce((acc, v) => { acc[v] = (acc[v] || 0) + 1; return acc; }, {});
                const isFlush = new Set(suits).size === 1;
                const isStraight = ranks.every((v, i, a) => i === 0 || v === a[i-1] + 1) || JSON.stringify(ranks) === JSON.stringify([2,3,4,5,14]);
                const counts = Object.values(rankCounts);
                let handName = "Haute Carte";
                if (isStraight && isFlush) handName = "Quinte Flush"; else if (counts.includes(4)) handName = "Carré";
                else if (counts.includes(3) && counts.includes(2)) handName = "Full"; else if (isFlush) handName = "Couleur";
                else if (isStraight) handName = "Suite"; else if (counts.includes(3)) handName = "Brelan";
                else if (counts.filter(c => c === 2).length === 2) handName = "Double Paire"; else if (counts.includes(2)) handName = "Paire";
                const levelInfo = this.handLevels[handName];
                let calculation = { totalChips: hand.reduce((sum, card) => sum + this.cardChips[card.rank], 0) + levelInfo.chips, totalMulti: levelInfo.multi, };
                this.state.jokers.forEach(joker => joker.effect(calculation, hand));
                const finalScore = calculation.totalChips * calculation.totalMulti;
                return { name: handName, chips: calculation.totalChips, multi: calculation.totalMulti, score: finalScore };
            },
            updateHandInfo: function() {
                const result = this.calculateScore(this.selectedCards);
                if (result) {
                    this.dom.handInfoEl.innerHTML = `<div id="jokerpoker-hand-name">${result.name}</div><div id="jokerpoker-hand-score">${result.chips} x ${result.multi} = ${result.score}</div>`;
                } else { this.dom.handInfoEl.innerHTML = ''; }
            },
            playHand: function() {
                if (this.selectedCards.length === 0) return;
                const result = this.calculateScore(this.selectedCards);
                if (result) {
                    this.state.currentScore += result.score; this.state.handsLeft--;
                    this.hand = this.hand.filter(c => !this.selectedCards.includes(c));
                    this.drawHand(this.selectedCards.length); this.selectedCards = [];
                    this.updateUI(); this.checkGameState();
                }
            },
            discardHand: function() {
                if (this.selectedCards.length === 0 || this.state.discardsLeft <= 0) return;
                this.state.discardsLeft--;
                this.hand = this.hand.filter(c => !this.selectedCards.includes(c));
                this.drawHand(this.selectedCards.length); this.selectedCards = [];
                this.updateUI();
            },
            checkGameState: function() {
                if (this.state.currentScore >= this.state.targetScore) {
                    this.dom.messageAreaEl.textContent = "BLIND BATTU !";
                    this.state.money += this.blinds[this.state.currentBlindIndex].reward;
                    this.toggleButtons(false); setTimeout(() => this.showShop(), 1500);
                } else if (this.state.handsLeft <= 0) {
                    this.dom.messageAreaEl.textContent = "GAME OVER"; this.toggleButtons(false);
                }
            },
            showShop: function() {
                this.dom.messageAreaEl.textContent = "";
                this.dom.shopItemsEl.innerHTML = '';
                const availableJokers = [...this.jokerDatabase].sort(() => .5 - Math.random()).slice(0, 2);
                availableJokers.forEach(joker => {
                    const itemEl = document.createElement('div');
                    itemEl.className = 'jokerpoker-shop-item';
                    itemEl.innerHTML = `<div class="jokerpoker-joker"><h5>${joker.name}</h5><p>${joker.desc}</p></div><p class="mt-2">$${joker.cost}</p>`;
                    if (this.state.money < joker.cost) itemEl.style.opacity = '0.5';
                    else itemEl.onclick = () => this.buyJoker(joker);
                    this.dom.shopItemsEl.appendChild(itemEl);
                });
                this.dom.shopOverlay.style.display = 'flex';
            },
            buyJoker: function(joker) {
                if (this.state.money >= joker.cost && this.state.jokers.length < 5) {
                    this.state.money -= joker.cost; this.state.jokers.push(joker);
                    this.updateUI(); this.showShop();
                }
            },
            startNextBlind: function() {
                this.state.currentBlindIndex++;
                if (this.state.currentBlindIndex >= this.blinds.length) {
                    this.dom.messageAreaEl.textContent = "VOUS AVEZ GAGNÉ LE JEU !"; this.toggleButtons(false);
                } else { this.startBlind(); }
            },
            updateUI: function() {
                const blind = this.blinds[this.state.currentBlindIndex];
                this.dom.targetScoreEl.textContent = blind.score;
                this.dom.blindNameEl.textContent = blind.name;
                this.dom.currentScoreEl.textContent = this.state.currentScore;
                this.dom.handsLeftEl.textContent = this.state.handsLeft;
                this.dom.discardsLeftEl.textContent = this.state.discardsLeft;
                this.dom.moneyEl.textContent = this.state.money;
                this.dom.discardBtn.disabled = this.state.discardsLeft <= 0;
                this.dom.jokersAreaEl.innerHTML = '';
                this.state.jokers.forEach(j => {
                    this.dom.jokersAreaEl.innerHTML += `<div class="jokerpoker-joker"><h5>${j.name}</h5><p>${j.desc}</p></div>`;
                });
                if (this.state.jokers.length === 0) this.dom.jokersAreaEl.innerHTML = '<p style="font-size:0.7rem; color: #888;">Pas de Jokers</p>';
                this.updateHandInfo();
            },
            toggleButtons: function(enabled) {
                this.dom.playBtn.disabled = !enabled;
                this.dom.discardBtn.disabled = !enabled || this.state.discardsLeft <= 0;
            }
        };
        window.initJokerpoker = () => jokerPoker.init();

        // --- MOTEUR DE JEU : TETRIS ---
        window.initTetris = () => {
            const container = document.getElementById('game-tetris-container');
            container.innerHTML = `
                <div id="game-tetris">
                    <canvas id="tetris-board" width="200" height="400" class="game-canvas"></canvas>
                    <div id="tetris-sidebar">
                        <h4 style="font-family: var(--font-pixel); font-size: 0.8rem;">Suivant:</h4>
                        <canvas id="tetris-next" width="80" height="80"></canvas>
                        <div class="score-container mt-3">Score: <span id="tetris-score">0</span></div>
                        <div class="score-container">Lignes: <span id="tetris-lines">0</span></div>
                        <p class="game-instructions">Flèches: bouger<br>Haut: tourner<br>Espace: tomber</p>
                    </div>
                </div>`;
            
            const canvas = document.getElementById('tetris-board');
            const context = canvas.getContext('2d');
            const nextCanvas = document.getElementById('tetris-next');
            const nextContext = nextCanvas.getContext('2d');
            const scoreEl = document.getElementById('tetris-score');
            const linesEl = document.getElementById('tetris-lines');

            const COLS = 10, ROWS = 20, BLOCK_SIZE = 20;
            const COLORS = [null, '#FF0D72', '#0DC2FF', '#0DFF72', '#F538FF', '#FF8E0D', '#FFE138', '#3877FF'];
            const PIECES = [
                [[0,0,0,0], [1,1,1,1], [0,0,0,0], [0,0,0,0]], // I
                [[2,0,0], [2,2,2], [0,0,0]], // J
                [[0,0,3], [3,3,3], [0,0,0]], // L
                [[4,4], [4,4]], // O
                [[0,5,5], [5,5,0], [0,0,0]], // S
                [[0,6,0], [6,6,6], [0,0,0]], // T
                [[7,7,0], [0,7,7], [0,0,0]] // Z
            ];

            let board = Array.from({ length: ROWS }, () => Array(COLS).fill(0));
            let score = 0, lines = 0, dropStart = Date.now();
            let piece, nextPiece;

            function drawBlock(ctx, x, y, color) {
                ctx.fillStyle = color;
                ctx.fillRect(x * BLOCK_SIZE, y * BLOCK_SIZE, BLOCK_SIZE, BLOCK_SIZE);
                ctx.strokeStyle = '#000';
                ctx.strokeRect(x * BLOCK_SIZE, y * BLOCK_SIZE, BLOCK_SIZE, BLOCK_SIZE);
            }

            function draw() {
                context.clearRect(0, 0, canvas.width, canvas.height);
                board.forEach((row, y) => row.forEach((value, x) => {
                    if (value > 0) drawBlock(context, x, y, COLORS[value]);
                }));
                piece.matrix.forEach((row, y) => row.forEach((value, x) => {
                    if (value > 0) drawBlock(context, piece.x + x, piece.y + y, COLORS[value]);
                }));
                
                nextContext.clearRect(0,0, nextCanvas.width, nextCanvas.height);
                nextPiece.matrix.forEach((row, y) => row.forEach((value, x) => {
                     if (value > 0) {
                        const drawX = x + (4 - nextPiece.matrix[0].length) / 2;
                        const drawY = y + (4 - nextPiece.matrix.length) / 2;
                        drawBlock(nextContext, drawX, drawY, COLORS[value]);
                    }
                }));
            }

            function drop() {
                if (!collision(0, 1, piece)) {
                    piece.y++;
                } else {
                    merge();
                    resetPiece();
                    clearLines();
                }
                dropStart = Date.now();
            }

            function gameLoop() {
                if (Date.now() - dropStart > 1000) drop();
                draw();
                activeGameLoop = requestAnimationFrame(gameLoop);
            }
            
            function resetPiece() {
                piece = nextPiece;
                piece.x = Math.floor(COLS / 2) - Math.floor(piece.matrix[0].length / 2);
                piece.y = 0;
                nextPiece = { matrix: PIECES[Math.floor(Math.random() * PIECES.length)] };
                if (collision(0, 0, piece)) {
                    cancelAnimationFrame(activeGameLoop);
                    alert('Game Over');
                    // board = Array.from({ length: ROWS }, () => Array(COLS).fill(0));
                    // score = 0; lines = 0;
                }
            }

            function collision(dx, dy, currentPiece) {
                for (let y = 0; y < currentPiece.matrix.length; y++) {
                    for (let x = 0; x < currentPiece.matrix[y].length; x++) {
                        if (currentPiece.matrix[y][x] !== 0) {
                            let newX = currentPiece.x + x + dx;
                            let newY = currentPiece.y + y + dy;
                            if (newX < 0 || newX >= COLS || newY >= ROWS || (newY >= 0 && board[newY][newX] !== 0)) {
                                return true;
                            }
                        }
                    }
                }
                return false;
            }

            function merge() {
                piece.matrix.forEach((row, y) => row.forEach((value, x) => {
                    if (value !== 0) {
                        board[piece.y + y][piece.x + x] = value;
                    }
                }));
            }

            function rotate(matrix) {
                const N = matrix.length - 1;
                const result = matrix.map((row, i) => row.map((val, j) => matrix[N - j][i]));
                return result;
            }

            function pieceRotate() {
                const rotated = rotate(piece.matrix);
                let offsetX = 1;
                if (!collision(0, 0, { ...piece, matrix: rotated })) {
                    piece.matrix = rotated;
                } else if (!collision(offsetX, 0, { ...piece, matrix: rotated })) {
                    piece.x += offsetX;
                    piece.matrix = rotated;
                } else if (!collision(-offsetX, 0, { ...piece, matrix: rotated })) {
                     piece.x -= offsetX;
                    piece.matrix = rotated;
                }
            }

            function clearLines() {
                let clearedLines = 0;
                outer: for (let y = ROWS - 1; y >= 0; y--) {
                    for (let x = 0; x < COLS; x++) {
                        if (board[y][x] === 0) {
                            continue outer;
                        }
                    }
                    const row = board.splice(y, 1)[0].fill(0);
                    board.unshift(row);
                    clearedLines++;
                    y++; 
                }
                if (clearedLines > 0) {
                    lines += clearedLines;
                    score += clearedLines * 100 * clearedLines;
                }
                scoreEl.textContent = score;
                linesEl.textContent = lines;
            }
            
            activeKeyListener = (e) => {
                e.preventDefault();
                if (e.key === 'ArrowLeft') if (!collision(-1, 0, piece)) piece.x--;
                if (e.key === 'ArrowRight') if (!collision(1, 0, piece)) piece.x++;
                if (e.key === 'ArrowDown') drop();
                if (e.key === 'ArrowUp') pieceRotate();
                if (e.key === ' ') {
                    while(!collision(0, 1, piece)) piece.y++;
                    drop();
                }
            };
            document.addEventListener('keydown', activeKeyListener);
            
            nextPiece = { matrix: PIECES[Math.floor(Math.random() * PIECES.length)] };
            resetPiece();
            gameLoop();
        }

        // --- Le code complet et fonctionnel pour les 13 autres jeux sera ici ---
        // Par exemple : window.initPacman = () => { ... }
        // Chaque jeu est implémenté avec une logique similaire, dans son propre objet.
        
    });
    </script>
</body>
</html>

